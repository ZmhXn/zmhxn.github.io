<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>浏览器渲染页面的原理及流程 | Mr.Zhang&#39;s blog</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="icon" href="/images/head-portrait.png">
    <meta name="description" content="My personal blog">
    
    <link rel="preload" href="/assets/css/0.styles.eea70ae1.css" as="style"><link rel="preload" href="/assets/js/app.c8406c88.js" as="script"><link rel="preload" href="/assets/js/2.0a7bd73d.js" as="script"><link rel="preload" href="/assets/js/14.1c04bfce.js" as="script"><link rel="prefetch" href="/assets/js/10.791ae3f5.js"><link rel="prefetch" href="/assets/js/11.bb106263.js"><link rel="prefetch" href="/assets/js/12.7734007a.js"><link rel="prefetch" href="/assets/js/13.10964154.js"><link rel="prefetch" href="/assets/js/15.4015dfe7.js"><link rel="prefetch" href="/assets/js/16.9eefdb6e.js"><link rel="prefetch" href="/assets/js/17.e19fcf24.js"><link rel="prefetch" href="/assets/js/3.0b1be0e9.js"><link rel="prefetch" href="/assets/js/4.27251d6f.js"><link rel="prefetch" href="/assets/js/5.ac3c6904.js"><link rel="prefetch" href="/assets/js/6.d1758749.js"><link rel="prefetch" href="/assets/js/7.fbffde9a.js"><link rel="prefetch" href="/assets/js/8.41f6708c.js"><link rel="prefetch" href="/assets/js/9.a28f2a7a.js">
    <link rel="stylesheet" href="/assets/css/0.styles.eea70ae1.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/images/head-portrait.png" alt="Mr.Zhang's blog" class="logo"> <span class="site-name can-hide">Mr.Zhang's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/index/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="JS" class="dropdown-title"><span class="title">JS</span> <span class="arrow down"></span></button> <button type="button" aria-label="JS" class="mobile-dropdown-title"><span class="title">JS</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/javaScript/dataStructure/dataStructure.html" class="nav-link">
  数据结构
</a></li><li class="dropdown-item"><!----> <a href="/javaScript/jsNote/reduce.html" class="nav-link">
  js笔记
</a></li></ul></div></div><div class="nav-item"><a href="/cssStyle/css.html" class="nav-link">
  CSS
</a></div><div class="nav-item"><a href="/vue/vue.html" class="nav-link">
  Vue
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面试文档" class="dropdown-title"><span class="title">面试文档</span> <span class="arrow down"></span></button> <button type="button" aria-label="面试文档" class="mobile-dropdown-title"><span class="title">面试文档</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/learningNotes/browserRendering/browserRenderingPrinciple.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  浏览器加载并渲染原理
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/ZmhXn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/index/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="JS" class="dropdown-title"><span class="title">JS</span> <span class="arrow down"></span></button> <button type="button" aria-label="JS" class="mobile-dropdown-title"><span class="title">JS</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/javaScript/dataStructure/dataStructure.html" class="nav-link">
  数据结构
</a></li><li class="dropdown-item"><!----> <a href="/javaScript/jsNote/reduce.html" class="nav-link">
  js笔记
</a></li></ul></div></div><div class="nav-item"><a href="/cssStyle/css.html" class="nav-link">
  CSS
</a></div><div class="nav-item"><a href="/vue/vue.html" class="nav-link">
  Vue
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面试文档" class="dropdown-title"><span class="title">面试文档</span> <span class="arrow down"></span></button> <button type="button" aria-label="面试文档" class="mobile-dropdown-title"><span class="title">面试文档</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/learningNotes/browserRendering/browserRenderingPrinciple.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  浏览器加载并渲染原理
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/ZmhXn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/learningNotes/browserRendering/browserRenderingPrinciple.html" aria-current="page" class="active sidebar-link">浏览器渲染页面的原理及流程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/learningNotes/browserRendering/browserRenderingPrinciple.html#加载html页面步骤" class="sidebar-link">加载HTML页面步骤</a></li><li class="sidebar-sub-header"><a href="/learningNotes/browserRendering/browserRenderingPrinciple.html#浏览器如何渲染网页" class="sidebar-link">浏览器如何渲染网页</a></li><li class="sidebar-sub-header"><a href="/learningNotes/browserRendering/browserRenderingPrinciple.html#回流和重绘-reflow和repaint" class="sidebar-link">回流和重绘（reflow和repaint）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/learningNotes/browserRendering/browserRenderingPrinciple.html#reflow-回流-也称重排" class="sidebar-link">reflow（回流，也称重排）</a></li><li class="sidebar-sub-header"><a href="/learningNotes/browserRendering/browserRenderingPrinciple.html#repaint-重绘" class="sidebar-link">repaint（重绘）</a></li></ul></li></ul></li><li><a href="/learningNotes/browserRendering/DNSPrinciple.html" class="sidebar-link">DNS解析原理及过程</a></li><li><a href="/learningNotes/browserRendering/tcpAgreement.html" class="sidebar-link">TCP</a></li><li><a href="/learningNotes/browserRendering/httpAndHttps.html" class="sidebar-link">HTTP与HTTPS</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="浏览器渲染页面的原理及流程"><a href="#浏览器渲染页面的原理及流程" class="header-anchor">#</a> 浏览器渲染页面的原理及流程</h1> <p>浏览器将域名通过网络通信从服务器拿到html文件后，如何渲染页面呢？</p> <h2 id="加载html页面步骤"><a href="#加载html页面步骤" class="header-anchor">#</a> 加载HTML页面步骤</h2> <p><img src="/images/browser-rendering.png" alt="img"></p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>1.当浏览器遇到link/script/img等请求后，都会开辟全新的线程去加载资源文件。开辟TASK QUEUE(任务队列)的线程，里面有各种任务，在等待着解析，
当主线程生成DOM树后，主线程会从TASK QUEUE(任务队列)的线程里拿到解析生成CSSOM的任务，一起构建渲染树（Render Tree）。<br>
2.如果TASK QUEUE(任务队列)中没有解析完成的任务，主线程就一直等待，如果有处理好的，就渲染，形成事件循环。</p></div> <h2 id="浏览器如何渲染网页"><a href="#浏览器如何渲染网页" class="header-anchor">#</a> 浏览器如何渲染网页</h2> <ul><li>1.根据html文件构建DOM树和CSSOM(CSS Object Model)树。构建DOM树期间，如果遇到JS，阻塞DOM树及CSSOM树的构建，优先加载JS文件，加载完毕，再继续构建DOM树及CSSOM树。</li> <li>2.构建渲染树（Render Tree）。</li> <li>3.页面的重绘（repaint）与回流（reflow，也有称重排）。页面渲染完成后，若JS操作了DOM节点，根据JS对DOM操作动作的大小，浏览器对页面进行重绘或是重排。
<div align="center"><img src="/images/render-tree.png" alt="img"></div></li></ul> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <ul><li>若在构建DOM树的过程中，当 HTML 解析器遇到一个 script 标记时，即遇到了js，将立即阻塞DOM树的构建，将控制权移交给 JavaScript 引擎，等到 JavaScript 引擎运行完毕，浏览器才会从中断的地方恢复DOM树的构建。
其根本原因在于，JS会对DOM节点进行操作，浏览器无法预测未来的DOM节点的具体内容，为了防止无效操作，节省资源，只能阻塞DOM树的构建。譬如，若不阻塞DOM树的构建，若JS删除了某个DOM节点A，那么浏览器为构建此节点A花费的资源就是无效的。</li> <li>若在HTML头部加载JS文件，由于JS阻塞，会推迟页面的首绘。为了加快页面渲染，一般将JS文件放到HTML底部进行加载，或是对JS文件执行async或defer加载。</li></ul></div> <h2 id="回流和重绘-reflow和repaint"><a href="#回流和重绘-reflow和repaint" class="header-anchor">#</a> 回流和重绘（reflow和repaint）</h2> <p>我们都知道HTML默认是流式布局的，但CSS和JS会打破这种布局，改变DOM的外观样式以及大小和位置。因此我们就需要知道两个概念：replaint和reflow。</p> <h3 id="reflow-回流-也称重排"><a href="#reflow-回流-也称重排" class="header-anchor">#</a> reflow（回流，也称重排）</h3> <p>当浏览器发现布局发生了变化（渲染树节点发生改变），影响了节点的几何属性（如宽、高、内边距、外边距、或是float、position、display：none;等等），导致节点位置发生变化，此时触发浏览器回流（reflow），需要重新生成渲染树，大家称这个回退的过程叫reflow。reflow会从html这个root frame开始递归往下，依次计算所有的结点几何尺寸和位置，以确认是渲染树的一部分发生变化还是整个渲染树。reflow几乎是无法避免的，因为只要用户进行交互操作，就势必会发生页面的一部分的重新渲染，且通常我们也无法预估浏览器到底会reflow哪一部分的代码，因为他们会相互影响。</p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>回流必将引起重绘，而重绘不一定会引起回流。</p></div> <h4 id="何时会引起回流"><a href="#何时会引起回流" class="header-anchor">#</a> 何时会引起回流？</h4> <p>当页面布局和几何属性改变时就需要回流。下述情况会发生浏览器回流：</p> <ul><li>添加或者删除可见的DOM元素；</li> <li>元素位置改变——display、float、position、overflow等等；</li> <li>元素尺寸改变——边距、填充、边框、宽度和高度</li> <li>内容改变——比如文本改变或者图片大小改变而引起的计算值宽度和高度改变；</li> <li>页面渲染初始化；</li> <li>浏览器窗口尺寸改变——resize事件发生时；</li></ul> <h4 id="如何减少和避免回流"><a href="#如何减少和避免回流" class="header-anchor">#</a> 如何减少和避免回流？</h4> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Reflow 的成本比 Repaint 的成本高得多的多。一个节点的 Reflow 很有可能导致子节点，甚至父节点以及兄弟节点的 Reflow 。在一些高性能的电脑上也许还没什么，但是如果 Reflow 发生在手机上，那么这个过程是延慢加载和耗电的。</p></div> <ol><li>直接改变className，如果动态改变样式，则使用cssText（考虑没有优化的浏览器）；<br></li> <li>让要操作的元素进行”离线处理”，处理完后一起更新；<br>
a) 使用DocumentFragment进行缓存操作,引发一次回流和重绘；<br>
b) 使用display:none技术，只引发两次回流和重绘；<br>
c) 使用cloneNode(true or false) 和 replaceChild 技术，引发一次回流和重绘；<br></li> <li>不要经常访问会引起浏览器flush队列的属性，如果你确实要访问，利用缓存；<br></li> <li>让元素脱离动画流，减少回流的Render Tree的规模；</li></ol> <h3 id="repaint-重绘"><a href="#repaint-重绘" class="header-anchor">#</a> repaint（重绘）</h3> <p>repaint则是当我们改变某个元素的背景色、文字颜色、边框颜色等等不影响它周围或内部布局的属性时，屏幕的一部分要重画，但是元素的几何尺寸和位置没有发生改变。</p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>需要注意的是，display:none会触发reflow，而visibility: hidden属性则并不算是不可见属性，它的语义是隐藏元素，但元素仍然占据着布局空间，它会被渲染成一个空框。所以visibility:hidden只会触发repaint，因为没有发生位置变化。</p></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新时间:</span> <span class="time">10/23/2019, 6:14:04 PM</span></div></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/learningNotes/browserRendering/DNSPrinciple.html">
        DNS解析原理及过程
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.c8406c88.js" defer></script><script src="/assets/js/2.0a7bd73d.js" defer></script><script src="/assets/js/14.1c04bfce.js" defer></script>
  </body>
</html>
