<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>DNS解析原理及过程 | Mr.Zhang&#39;s blog</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="icon" href="/images/head-portrait.png">
    <meta name="description" content="My personal blog">
    
    <link rel="preload" href="/assets/css/0.styles.eea70ae1.css" as="style"><link rel="preload" href="/assets/js/app.c8406c88.js" as="script"><link rel="preload" href="/assets/js/2.0a7bd73d.js" as="script"><link rel="preload" href="/assets/js/13.10964154.js" as="script"><link rel="prefetch" href="/assets/js/10.791ae3f5.js"><link rel="prefetch" href="/assets/js/11.bb106263.js"><link rel="prefetch" href="/assets/js/12.7734007a.js"><link rel="prefetch" href="/assets/js/14.1c04bfce.js"><link rel="prefetch" href="/assets/js/15.4015dfe7.js"><link rel="prefetch" href="/assets/js/16.9eefdb6e.js"><link rel="prefetch" href="/assets/js/17.e19fcf24.js"><link rel="prefetch" href="/assets/js/3.0b1be0e9.js"><link rel="prefetch" href="/assets/js/4.27251d6f.js"><link rel="prefetch" href="/assets/js/5.ac3c6904.js"><link rel="prefetch" href="/assets/js/6.d1758749.js"><link rel="prefetch" href="/assets/js/7.fbffde9a.js"><link rel="prefetch" href="/assets/js/8.41f6708c.js"><link rel="prefetch" href="/assets/js/9.a28f2a7a.js">
    <link rel="stylesheet" href="/assets/css/0.styles.eea70ae1.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/images/head-portrait.png" alt="Mr.Zhang's blog" class="logo"> <span class="site-name can-hide">Mr.Zhang's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/index/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="JS" class="dropdown-title"><span class="title">JS</span> <span class="arrow down"></span></button> <button type="button" aria-label="JS" class="mobile-dropdown-title"><span class="title">JS</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/javaScript/dataStructure/dataStructure.html" class="nav-link">
  数据结构
</a></li><li class="dropdown-item"><!----> <a href="/javaScript/jsNote/reduce.html" class="nav-link">
  js笔记
</a></li></ul></div></div><div class="nav-item"><a href="/cssStyle/css.html" class="nav-link">
  CSS
</a></div><div class="nav-item"><a href="/vue/vue.html" class="nav-link">
  Vue
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面试文档" class="dropdown-title"><span class="title">面试文档</span> <span class="arrow down"></span></button> <button type="button" aria-label="面试文档" class="mobile-dropdown-title"><span class="title">面试文档</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/learningNotes/browserRendering/browserRenderingPrinciple.html" class="nav-link">
  浏览器加载并渲染原理
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/ZmhXn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/index/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="JS" class="dropdown-title"><span class="title">JS</span> <span class="arrow down"></span></button> <button type="button" aria-label="JS" class="mobile-dropdown-title"><span class="title">JS</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/javaScript/dataStructure/dataStructure.html" class="nav-link">
  数据结构
</a></li><li class="dropdown-item"><!----> <a href="/javaScript/jsNote/reduce.html" class="nav-link">
  js笔记
</a></li></ul></div></div><div class="nav-item"><a href="/cssStyle/css.html" class="nav-link">
  CSS
</a></div><div class="nav-item"><a href="/vue/vue.html" class="nav-link">
  Vue
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面试文档" class="dropdown-title"><span class="title">面试文档</span> <span class="arrow down"></span></button> <button type="button" aria-label="面试文档" class="mobile-dropdown-title"><span class="title">面试文档</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/learningNotes/browserRendering/browserRenderingPrinciple.html" class="nav-link">
  浏览器加载并渲染原理
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/ZmhXn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/learningNotes/browserRendering/browserRenderingPrinciple.html" class="sidebar-link">浏览器渲染页面的原理及流程</a></li><li><a href="/learningNotes/browserRendering/DNSPrinciple.html" aria-current="page" class="active sidebar-link">DNS解析原理及过程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/learningNotes/browserRendering/DNSPrinciple.html#为什么需要dns解析域名为ip地址" class="sidebar-link">为什么需要DNS解析域名为IP地址？</a></li><li class="sidebar-sub-header"><a href="/learningNotes/browserRendering/DNSPrinciple.html#什么是dns" class="sidebar-link">什么是DNS？</a></li><li class="sidebar-sub-header"><a href="/learningNotes/browserRendering/DNSPrinciple.html#dns域名解析基本过程" class="sidebar-link">DNS域名解析基本过程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/learningNotes/browserRendering/DNSPrinciple.html#递归查询" class="sidebar-link">递归查询</a></li><li class="sidebar-sub-header"><a href="/learningNotes/browserRendering/DNSPrinciple.html#迭代查询" class="sidebar-link">迭代查询</a></li></ul></li><li class="sidebar-sub-header"><a href="/learningNotes/browserRendering/DNSPrinciple.html#几种域名解析方式" class="sidebar-link">几种域名解析方式</a></li><li class="sidebar-sub-header"><a href="/learningNotes/browserRendering/DNSPrinciple.html#关于dns解析的ttl参数" class="sidebar-link">关于DNS解析的TTL参数</a></li></ul></li><li><a href="/learningNotes/browserRendering/tcpAgreement.html" class="sidebar-link">TCP</a></li><li><a href="/learningNotes/browserRendering/httpAndHttps.html" class="sidebar-link">HTTP与HTTPS</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="dns解析原理及过程"><a href="#dns解析原理及过程" class="header-anchor">#</a> DNS解析原理及过程</h1> <h2 id="为什么需要dns解析域名为ip地址"><a href="#为什么需要dns解析域名为ip地址" class="header-anchor">#</a> 为什么需要DNS解析域名为IP地址？</h2> <p>网络通讯大部分是基于TCP/IP的，而TCP/IP是基于IP地址的，所以计算机在网络上进行通讯时只能识别如“202.96.134.133”之类的IP地址，而不能认识域名。我们无法记住10个以上IP地址的网站，所以我们访问网站时，更多的是在浏览器地址栏中输入域名，就能看到所需要的页面，这是因为有一个叫“DNS服务器”的计算机自动把我们的域名“翻译”成了相应的IP地址，然后调出IP地址所对应的网页。</p> <h2 id="什么是dns"><a href="#什么是dns" class="header-anchor">#</a> 什么是DNS？</h2> <p>DNS( Domain Name System)是“域名系统”的英文缩写，是一种组织成域层次结构的计算机和网络服务命名系统，它用于TCP/IP网络，它所提供的服务是用来将主机名和域名转换为IP地址的工作。DNS就是这样的一位“翻译官”，它的基本工作原理可用下图来表示。
</p><div align="center"><img src="/images/dns-img.png" alt="img"></div><p></p> <h2 id="dns域名解析基本过程"><a href="#dns域名解析基本过程" class="header-anchor">#</a> DNS域名解析基本过程</h2> <p>用一个图总结下就是：
</p><div align="center"><img src="/images/dns-analysis.png" alt="img"></div><p></p> <ul><li>第一步，浏览器会检查缓存中有没有这个域名的对应解析IP，如果存在，返回IP地址解析完成。</li></ul> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>浏览器的缓存也是有大小时间限制的，可以通过TTL属性来设置，当然这个时间也是要控制好，太长如果服务器IP变化将会导致用户无法访问页面，如果太短就失去了缓存的意义。</p></div> <ul><li>第二步，如果缓存中没有对应的解析IP，浏览器会查找本机操作系统中是否存在该解析IP。</li></ul> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>在windows系统中，可以通过C:\Windows\System32\drivers\etc下的host文件来修改。可以将任何的域名映射到对应的IP地址中。</p></div> <ul><li>第三步，如果上面两步都不存在，我们的网络配置中会有“DNS服务器地址”这一项，操作系统会将请求的域名发送给这里设置的LDNS（本地区域名服务器）。</li></ul> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>这个LDNS，一般都在你所在城市的某个角落，如果你是校内网，那么这个服务器就在你的学校内，如果是家用的，这个DNS就会提供给你互联网的服务接入商，即电信移动等。在windows下我们可以用ipconfig命令看到。LDNS 承担了80%的域名解析。</p></div> <ul><li>第四步，如果第三步也没有查询到，就直接到Root Server 根域名服务器请求解析。</li> <li>第五步，根域名服务器返回给本地域名服务器一个所查询的主域名服务器（gTLD Server）地址，gTLD Server：国际顶级域名服务器，共有13台左右包括（cn、com、org等）</li> <li>第六步，本地域名服务器（Local DNS Server）再向上一步返回的gTLD Server（顶级域名服务器）发送请求。</li> <li>第七步，gTLD Server（顶级域名服务器）返回查询的对应域名的Name Server域名服务器地址，这个就是我们平时注册域名的服务器（163.com域服务器）。</li> <li>第八步，Name Server会查询存储的域名与IP地址的映射关系表，连同一个TTL值返回给DNS Server域名解析服务器。</li> <li>第九步，返回该域名对应的IP和TTL值，由Local DNS Server来缓存，缓存时间由TTL值来控制。</li> <li>第十步，把解析的地址返回给用户，TTL值由浏览器缓存在本地系统，域名解析完成。</li></ul> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>从客户端到本地DNS服务器是属于递归查询，而DNS服务器之间就是的交互查询就是迭代查询。</p></div> <h3 id="递归查询"><a href="#递归查询" class="header-anchor">#</a> 递归查询</h3> <p>如果主机所询问的本地域名服务器不知道被查询的域名的IP地址，那么本地域名服务器就以DNS客户的身份，向其它根域名服务器继续发出查询请求报文(即替主机继续查询)，而不是让主机自己进行下一步查询。因此，递归查询返回的查询结果或者是所要查询的IP地址，或者是报错，表示无法查询到所需的IP地址。</p> <h3 id="迭代查询"><a href="#迭代查询" class="header-anchor">#</a> 迭代查询</h3> <p>当根域名服务器收到本地域名服务器发出的迭代查询请求报文时，要么给出所要查询的IP地址，要么告诉本地服务器：“你下一步应当向哪一个域名服务器进行查询”。然后让本地服务器进行后续的查询。根域名服务器通常是把自己知道的顶级域名服务器的IP地址告诉本地域名服务器，让本地域名服务器再向顶级域名服务器查询。顶级域名服务器在收到本地域名服务器的查询请求后，要么给出所要查询的IP地址，要么告诉本地服务器下一步应当向哪一个权限域名服务器进行查询。最后，知道了所要解析的IP地址或报错，然后把这个结果返回给发起查询的主机。</p> <h2 id="几种域名解析方式"><a href="#几种域名解析方式" class="header-anchor">#</a> 几种域名解析方式</h2> <ul><li>A记录，a就是Address的简写，用来指定域名对应IP的地址，比如：items.taobao.com指定到115.238.23.241，switch.taobao.com指定到121.14.24.241。A记录可以将多个域名映射到一个IP地址，但是不能一个域名对应多个IP。</li> <li>MX记录：MX代表的是Mail Exchage，就是可以将某个域名下的邮件服务器指向自己的Mail Server，如baidu.com域名的A记录IP地址是180.97.34.157，如果将MX记录设置为180.97.34.154，即xxx@baidu.com的邮件路由，那么DNS会将邮件发送到180.97.34.154所在的服务器，而正常web请求仍然会解析到A记录的IP地址180.97.34.157。</li> <li>CNAME记录 ，全成Canonical Name（别名解析）。就是将一个域名设置成一个或多个别名，比如将baidu.com解析到itlemon.cn，将csdn.net解析到itlemon.cn，那么itlemon.cn就是baidu.com和CSDN.net的别名。</li> <li>NS记录：就是为某个域名指定了特定的DNS服务器去解析。</li> <li>TXT记录：为某个主机名或者域名设置特定的说明，比如为itlemon.cn设置的的TXT记录为“Lemon的技术笔记”，这个TXT记录为itlemon.cn的说明。</li></ul> <h2 id="关于dns解析的ttl参数"><a href="#关于dns解析的ttl参数" class="header-anchor">#</a> 关于DNS解析的TTL参数</h2> <p>我们在配置DNS解析的时候，有一个参数常常容易忽略，就是DNS解析的TTL参数，Time To Live。TTL这个参数告诉本地DNS服务器，域名缓存的最长时间。用阿里云解析来举例，阿里云解析默认的TTL是10分钟，10分钟的含义是，本地DNS服务器对于域名的缓存时间是10分钟，10分钟之后，本地DNS服务器就会删除这条记录，删除之后，如果有用户访问这个域名，就要重复一遍上述复杂的流程。</p> <p>其实，如果网站已经进入稳定发展的状态，不会轻易更换IP地址，我们完全可以将TTL设置到协议最大值，即24小时。带来的好处是，让域名解析记录能够更长时间的存放在本地DNS服务器中，以加快所有用户的访问。设置成24小时，其实，还解决了Googlebot在全球部署的服务器抓取网站可能带来的问题。</p> <p>阿里云之所以只将TTL设置成10分钟，是为了让域名解析更快生效而已。因为之前的解析会在最长10分钟之后失效（本地DNS服务器将对应的解析条目删除），然后新的解析生效。如果是24小时，这个生效的时间最长就是24小时，甚至更长（本地DNS服务器要有用户请求，才会发起查询）。</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新时间:</span> <span class="time">11/1/2019, 6:09:39 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/learningNotes/browserRendering/browserRenderingPrinciple.html" class="prev">
        浏览器渲染页面的原理及流程
      </a></span> <span class="next"><a href="/learningNotes/browserRendering/tcpAgreement.html">
        TCP
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.c8406c88.js" defer></script><script src="/assets/js/2.0a7bd73d.js" defer></script><script src="/assets/js/13.10964154.js" defer></script>
  </body>
</html>
